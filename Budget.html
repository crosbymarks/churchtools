<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="html-title">Calculadora de Presupuesto Familiar</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Setting 'Inter' as the main font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .budget-category-row {
            transition: background-color 0.2s;
        }
        .budget-category-row:hover {
            background-color: #f0f4f8;
        }
        /* Style for the adjustment inputs */
        .input-style {
            padding: 0.5rem;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* border-gray-300 */
            width: 100%;
            text-align: right;
        }
        /* Custom scrollbar style for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
        }
        /* Home Icon SVG Style */
        .home-icon-svg {
            width: 28px;
            height: 28px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 md:p-10">

        <!-- Header with Home Button in the upper left, above the Title -->
        <header class="mb-8 pb-4 border-b border-gray-200">
            
            <!-- Home Icon Link (Upper Left) -->
            <div class="flex justify-start mb-4">
                <a href="/" class="text-gray-600 hover:text-blue-600 transition duration-150 p-2 rounded-full hover:bg-gray-100" aria-label="Go to home page">
                    <svg class="home-icon-svg" viewBox="0 0 24 24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </a>
            </div>
            
            <!-- Title and Subtitle -->
            <div>
                <h1 id="header-title" class="text-3xl md:text-4xl font-extrabold text-blue-800 mb-2">Administración del Presupuesto Familiar</h1>
                <p id="header-subtitle" class="text-gray-600 text-lg">Planifica, ajusta y administra tus Ingresos Netos Disponibles (IND).</p>
            </div>
        </header>


        <!-- Income Input Section -->
        <section class="bg-blue-50 p-6 rounded-lg shadow-inner mb-8">
            <h2 id="section-1-title" class="text-xl font-semibold text-blue-700 mb-4">1. Ingresos Netos Disponibles (IND)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <label for="income-amount" id="income-label" class="block text-sm font-medium text-gray-700 mb-1">Monto de Ingreso Neto:</label>
                    <input type="number" id="income-amount" value="5000" min="0" class="input-style border-blue-300 focus:border-blue-500 focus:ring-blue-500" placeholder="Ej. 5000">
                </div>
                <div>
                    <label for="income-frequency" id="frequency-label" class="block text-sm font-medium text-gray-700 mb-1">Frecuencia:</label>
                    <select id="income-frequency" class="input-style border-blue-300 focus:border-blue-500 focus:ring-blue-500">
                        <!-- Options populated/translated by JS -->
                    </select>
                </div>
            </div>
            <p id="monthly-income-display" class="mt-4 text-lg font-bold text-blue-800 text-center md:text-left"></p>
        </section>

        <!-- Budget Table and Breakdown -->
        <section class="mb-8">
            <h2 id="section-2-title" class="text-xl font-semibold text-blue-700 mb-4">2. Distribución del Presupuesto</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" id="th-category" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">Categoría</th>
                            <th scope="col" id="th-suggested" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6">Sugerido (%)</th>
                            <th scope="col" id="th-actual" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6">Actual (%)</th>
                            <th scope="col" id="th-amount" class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">Monto ($)</th>
                        </tr>
                    </thead>
                    <tbody id="budget-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Budget rows will be injected here by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr id="total-assigned-row" class="bg-gray-100 font-bold text-gray-800 transition-colors">
                            <td id="td-total-assigned" class="px-3 py-3 text-left text-sm">TOTAL ASIGNADO</td>
                            <td class="px-3 py-3 text-center text-sm" id="total-percent"></td>
                            <td class="px-3 py-3 text-center text-sm"></td>
                            <td class="px-3 py-3 text-right text-sm" id="total-amount"></td>
                        </tr>
                        <tr id="remaining-balance-row" class="bg-blue-100 font-bold text-blue-800 transition-colors">
                            <td id="td-remaining-balance" class="px-3 py-3 text-left text-sm">BALANCE RESTANTE (IND - GASTOS)</td>
                            <td colspan="2" class="px-3 py-3 text-center text-sm"></td>
                            <td class="px-3 py-3 text-right text-sm" id="remaining-balance"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- Visual Chart Summary -->
        <section>
            <h2 id="section-3-title" class="text-xl font-semibold text-blue-700 mb-4">3. Vista General de la Distribución</h2>
            <div id="chart-container" class="w-full h-8 flex rounded-full overflow-hidden bg-gray-200 shadow-md">
                <!-- Chart segments will be injected here -->
            </div>
            
            <p id="alert-message" class="mt-4 text-red-600 font-bold hidden text-center p-3 border border-red-300 rounded-lg bg-red-50">
                ¡Advertencia! El total de sus gastos excede el 100% de sus Ingresos Netos Disponibles (IND). Por favor, ajuste las categorías.
            </p>
        </section>

        <!-- Language Switch -->
        <div class="mt-10 pt-6 border-t border-gray-300 flex justify-center items-center">
            <div class="inline-flex rounded-full bg-gray-200 p-1">
                <button id="lang-es" data-lang="es" class="px-4 py-2 text-sm font-medium rounded-full transition-colors duration-200">
                    Español
                </button>
                <button id="lang-en" data-lang="en" class="px-4 py-2 text-sm font-medium rounded-full transition-colors duration-200">
                    English
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA SETUP ---
        const budgetCategories = [
            // name_es and name_en added for translation
            { id: 'diezmo', name_es: 'Dar (Diezmo/Caridad)', name_en: 'Giving (Tithes/Charity)', defaultPercent: 10, color: 'bg-green-600', percent: 10, amount: 0 },
            { id: 'ahorro', name_es: 'Ahorro (Emergencia/Retiro)', name_en: 'Savings (Emergency/Retirement)', defaultPercent: 15, color: 'bg-indigo-600', percent: 15, amount: 0 },
            { id: 'vivienda', name_es: 'Vivienda (Alquiler/Hipoteca)', name_en: 'Housing (Rent/Mortgage)', defaultPercent: 25, color: 'bg-blue-600', percent: 25, amount: 0 },
            { id: 'alimentos', name_es: 'Alimentos y Hogar', name_en: 'Food and Household', defaultPercent: 10, color: 'bg-yellow-600', percent: 10, amount: 0 },
            { id: 'transporte', name_es: 'Transporte', name_en: 'Transportation', defaultPercent: 5, color: 'bg-purple-600', percent: 5, amount: 0 },
            { id: 'deudas', name_es: 'Deudas (No Hipotecarias)', name_en: 'Debt (Non-Mortgage)', defaultPercent: 15, color: 'bg-red-600', percent: 15, amount: 0 },
            { id: 'salud', name_es: 'Salud y Cuidado Personal', name_en: 'Health and Personal Care', defaultPercent: 5, color: 'bg-pink-600', percent: 5, amount: 0 },
            { id: 'educacion', name_es: 'Educación/Hijos', name_en: 'Education/Children', defaultPercent: 5, color: 'bg-teal-600', percent: 5, amount: 0 },
            { id: 'otros', name_es: 'Entretenimiento/Misceláneos', name_en: 'Entertainment/Miscellaneous', defaultPercent: 10, color: 'bg-gray-600', percent: 10, amount: 0 },
        ];
        
        const translations = {
            'es': {
                htmlTitle: 'Calculadora de Presupuesto Familiar',
                header: 'Administración del Presupuesto Familiar',
                headerSubtitle: 'Planifica, ajusta y administra tus Ingresos Netos Disponibles (IND).',
                section1Title: '1. Ingresos Netos Disponibles (IND)',
                incomeLabel: 'Monto de Ingreso Neto:',
                frequencyLabel: 'Frecuencia:',
                frequencyMonthly: 'Mensual',
                frequencyWeekly: 'Semanal',
                frequencyAnnually: 'Anual',
                monthlyIncomeDisplay: (ind) => `Tu IND Mensual es: ${ind}`,
                section2Title: '2. Distribución del Presupuesto',
                tableHeaderCategory: 'Categoría',
                tableHeaderSuggested: 'Sugerido (%)',
                tableHeaderActual: 'Actual (%)',
                tableHeaderAmount: 'Monto ($)',
                totalAssigned: 'TOTAL ASIGNADO',
                remainingBalance: 'BALANCE RESTANTE (IND - GASTOS)',
                section3Title: '3. Vista General de la Distribución',
                alertMessage: '¡Advertencia! El total de sus gastos excede el 100% de sus Ingresos Netos Disponibles (IND). Por favor, ajuste las categorías.',
                category: (cat) => cat.name_es,
            },
            'en': {
                htmlTitle: 'Family Budget Calculator',
                header: 'Family Budget Administration',
                headerSubtitle: 'Plan, adjust, and manage your Net Disposable Income (NDI).',
                section1Title: '1. Net Disposable Income (NDI)',
                incomeLabel: 'Net Income Amount:',
                frequencyLabel: 'Frequency:',
                frequencyMonthly: 'Monthly',
                frequencyWeekly: 'Weekly',
                frequencyAnnually: 'Annually',
                monthlyIncomeDisplay: (ind) => `Your Monthly NDI is: ${ind}`,
                section2Title: '2. Budget Distribution',
                tableHeaderCategory: 'Category',
                tableHeaderSuggested: 'Suggested (%)',
                tableHeaderActual: 'Actual (%)',
                tableHeaderAmount: 'Amount ($)',
                totalAssigned: 'TOTAL ASSIGNED',
                remainingBalance: 'REMAINING BALANCE (NDI - EXPENSES)',
                section3Title: '3. Distribution Overview',
                alertMessage: 'Warning! Your total expenses exceed 100% of your Net Disposable Income (NDI). Please adjust the categories.',
                category: (cat) => cat.name_en,
            }
        };

        // --- DOM REFERENCES ---
        const htmlTitle = document.getElementById('html-title');
        const incomeAmountInput = document.getElementById('income-amount');
        const incomeFrequencySelect = document.getElementById('income-frequency');
        const monthlyIncomeDisplay = document.getElementById('monthly-income-display');
        const budgetTableBody = document.getElementById('budget-table-body');
        const totalPercentElement = document.getElementById('total-percent');
        const totalAmountElement = document.getElementById('total-amount');
        const totalAssignedRow = document.getElementById('total-assigned-row');
        const remainingBalanceElement = document.getElementById('remaining-balance');
        const remainingBalanceRow = document.getElementById('remaining-balance-row');
        const chartContainer = document.getElementById('chart-container');
        const alertMessage = document.getElementById('alert-message');
        const esButton = document.getElementById('lang-es');
        const enButton = document.getElementById('lang-en');

        // --- STATE ---
        let monthlyIND = 0; // Ingresos Netos Disponibles Mensuales
        let currentLang = 'es';

        // --- UTILITIES ---
        const formatter = new Intl.NumberFormat('es-US', {
            style: 'currency',
            currency: 'USD',
        });

        // --- CORE LOGIC ---

        function calculateMonthlyIND() {
            const amount = parseFloat(incomeAmountInput.value) || 0;
            const frequency = incomeFrequencySelect.value;
            let annualIncome = 0;

            // 1. Convert to Annual Income
            switch (frequency) {
                case 'weekly':
                    annualIncome = amount * 52; 
                    break;
                case 'monthly':
                    annualIncome = amount * 12;
                    break;
                case 'annually':
                    annualIncome = amount;
                    break;
            }

            // 2. Convert to Monthly Net Income (IND)
            return annualIncome / 12;
        }

        function calculateBudgetBreakdown() {
            monthlyIND = calculateMonthlyIND();
            let totalAmountAssigned = 0;
            let totalPercentAssigned = 0;

            budgetCategories.forEach(category => {
                // When income changes, recalculate amounts based on existing percentages
                category.amount = (monthlyIND * category.percent) / 100;
                
                totalAmountAssigned += category.amount;
                totalPercentAssigned += category.percent;
            });

            // Update state and UI
            updateUI(totalAmountAssigned, totalPercentAssigned);
        }

        function handleCategoryUpdate(id, source, value) {
            
            const category = budgetCategories.find(c => c.id === id);
            const newValue = parseFloat(value) || 0;
            
            if (!category || monthlyIND === 0) return;

            if (source === 'percent') {
                category.percent = Math.max(0, newValue);
                category.amount = (monthlyIND * category.percent) / 100;
            } else if (source === 'amount') {
                category.amount = Math.max(0, newValue);
                category.percent = (monthlyIND > 0) ? (category.amount / monthlyIND) * 100 : 0;
            }

            // Recalculate all totals
            let totalAssigned = 0;
            let totalPercentAssigned = 0;

            budgetCategories.forEach(c => {
                totalAssigned += c.amount;
                totalPercentAssigned += c.percent;
            });

            // Re-render UI
            updateUI(totalAssigned, totalPercentAssigned);
            renderBudgetTable();
        }

        function updateUI(totalAmountAssigned, totalPercentAssigned) {
            const remainingBalance = monthlyIND - totalAmountAssigned;
            const overBudget = totalPercentAssigned > 100.001; 
            const t = translations[currentLang];

            // 1. Update Monthly IND Display
            monthlyIncomeDisplay.textContent = t.monthlyIncomeDisplay(formatter.format(monthlyIND));

            // 2. Update Totals
            totalPercentElement.textContent = `${totalPercentAssigned.toFixed(2)}%`;
            totalAmountElement.textContent = formatter.format(totalAmountAssigned);

            // Conditional styling for TOTAL ROW
            if (overBudget) {
                totalAssignedRow.classList.add('bg-red-200', 'text-red-800');
                totalAssignedRow.classList.remove('bg-gray-100', 'text-gray-800');
                alertMessage.classList.remove('hidden'); 
            } else {
                totalAssignedRow.classList.remove('bg-red-200', 'text-red-800');
                totalAssignedRow.classList.add('bg-gray-100', 'text-gray-800');
                alertMessage.classList.add('hidden');
            }


            // 3. Update Remaining Balance (Conditional Styling)
            remainingBalanceElement.textContent = formatter.format(remainingBalance);
            
            if (remainingBalance < -0.01) { 
                remainingBalanceElement.classList.remove('text-blue-800');
                remainingBalanceElement.classList.add('text-red-600');
                remainingBalanceRow.classList.remove('bg-blue-100');
                remainingBalanceRow.classList.add('bg-red-50');
            } else { 
                remainingBalanceElement.classList.remove('text-red-600');
                remainingBalanceElement.classList.add('text-blue-800'); 
                remainingBalanceRow.classList.remove('bg-red-50');
                remainingBalanceRow.classList.add('bg-blue-100');
            }

            // 4. Update Chart
            renderChart();
        }

        function renderBudgetTable() {
            budgetTableBody.innerHTML = ''; // Clear table
            const t = translations[currentLang];
            
            budgetCategories.forEach(category => {
                const row = document.createElement('tr');
                row.classList.add('budget-category-row');
                
                const displayPercent = isNaN(category.percent) ? 0.00 : category.percent;
                const displayAmount = isNaN(category.amount) ? 0.00 : category.amount;
                
                // Get the translated category name
                const categoryName = t.category(category);

                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                        <span class="inline-block w-3 h-3 rounded-full ${category.color} mr-2 align-middle"></span>
                        ${categoryName}
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 text-center">${category.defaultPercent}%</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm">
                        <input type="number" id="${category.id}-percent" value="${displayPercent.toFixed(2)}" min="0" max="1000" step="0.01"
                               class="input-style text-center w-full max-w-[80px] mx-auto"
                               data-category-id="${category.id}" data-type="percent">
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm">
                        <div class="relative flex items-center">
                             <span class="absolute left-2 text-gray-500 text-xs">$</span>
                             <input type="number" id="${category.id}-amount" value="${displayAmount.toFixed(2)}" min="0" step="0.01"
                                class="input-style pl-5"
                                data-category-id="${category.id}" data-type="amount">
                        </div>
                    </td>
                `;
                budgetTableBody.appendChild(row);
            });

            // Attach listeners to new inputs
            document.querySelectorAll('#budget-table-body input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const id = e.target.dataset.categoryId;
                    const type = e.target.dataset.type;
                    handleCategoryUpdate(id, type, e.target.value);
                });
            });
        }

        function renderChart() {
            chartContainer.innerHTML = ''; // Clear chart
            const t = translations[currentLang];
            
            let currentTotalPercent = 0;
            budgetCategories.forEach(category => {
                currentTotalPercent += category.percent;
            });

            const proportionalBase = Math.max(currentTotalPercent, 100);

            // Render categories
            budgetCategories.forEach(category => {
                if (category.percent > 0) {
                    const widthPercent = (category.percent / proportionalBase) * 100;
                    
                    const segment = document.createElement('div');
                    segment.style.width = `${widthPercent.toFixed(2)}%`;
                    segment.classList.add(category.color, 'h-full', 'transition-all', 'duration-300');
                    
                    const categoryName = t.category(category);
                    segment.title = `${categoryName}: ${category.percent.toFixed(2)}% (${formatter.format(category.amount)})`;
                    chartContainer.appendChild(segment);
                }
            });

            // Add remaining balance segment (ONLY if the total assigned is < 100%)
            const remainingPercent = 100 - currentTotalPercent;
            if (remainingPercent > 0) {
                 const remainingSegment = document.createElement('div');
                 remainingSegment.style.width = `${remainingPercent.toFixed(2)}%`;
                 remainingSegment.classList.add('bg-gray-300', 'h-full', 'transition-all', 'duration-300');
                 
                 const remainingBalanceText = t.remainingBalance.split('(')[0].trim();
                 remainingSegment.title = `${remainingBalanceText}: ${remainingPercent.toFixed(2)}%`;

                 chartContainer.appendChild(remainingSegment);
                 
            }
        }
        
        // --- LANGUAGE LOGIC ---
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            const t = translations[lang];

            // 1. Update general elements
            htmlTitle.textContent = t.htmlTitle;
            document.getElementById('header-title').textContent = t.header;
            document.getElementById('header-subtitle').textContent = t.headerSubtitle;
            document.getElementById('section-1-title').textContent = t.section1Title;
            document.getElementById('income-label').textContent = t.incomeLabel;
            document.getElementById('frequency-label').textContent = t.frequencyLabel;
            document.getElementById('section-2-title').textContent = t.section2Title;
            document.getElementById('th-category').textContent = t.tableHeaderCategory;
            document.getElementById('th-suggested').textContent = t.tableHeaderSuggested;
            document.getElementById('th-actual').textContent = t.tableHeaderActual;
            document.getElementById('th-amount').textContent = t.tableHeaderAmount;
            document.getElementById('td-total-assigned').textContent = t.totalAssigned;
            document.getElementById('td-remaining-balance').textContent = t.remainingBalance;
            document.getElementById('section-3-title').textContent = t.section3Title;
            document.getElementById('alert-message').textContent = t.alertMessage;

            // 2. Update frequency options
            incomeFrequencySelect.innerHTML = `
                <option value="monthly">${t.frequencyMonthly}</option>
                <option value="weekly">${t.frequencyWeekly}</option>
                <option value="annually">${t.frequencyAnnually}</option>
            `;
            // Re-select the previous value after updating options
            incomeFrequencySelect.value = incomeFrequencySelect.dataset.current || 'monthly';

            // 3. Update table rows (requires re-rendering)
            renderBudgetTable();
            // Re-calculate and update totals/messages
            calculateBudgetBreakdown();

            // 4. Update button styles
            esButton.classList.remove('bg-blue-600', 'text-white');
            enButton.classList.remove('bg-blue-600', 'text-white');
            esButton.classList.add('text-gray-700', 'hover:bg-gray-300');
            enButton.classList.add('text-gray-700', 'hover:bg-gray-300');

            if (lang === 'es') {
                esButton.classList.add('bg-blue-600', 'text-white');
                esButton.classList.remove('text-gray-700', 'hover:bg-gray-300');
            } else {
                enButton.classList.add('bg-blue-600', 'text-white');
                enButton.classList.remove('text-gray-700', 'hover:bg-gray-300');
            }

            // Save preference
            localStorage.setItem('budgetLanguagePreference', lang);
        }

        // --- INITIALIZATION AND EVENT LISTENERS ---
        function init() {
            // Load language preference
            const storedLang = localStorage.getItem('budgetLanguagePreference') || 'es';
            setLanguage(storedLang);

            // Store current frequency selection
            incomeFrequencySelect.dataset.current = incomeFrequencySelect.value;
            
            // Apply default percentages to the initial state
            calculateBudgetBreakdown();
            renderBudgetTable();

            // Event listeners for Income inputs
            incomeAmountInput.addEventListener('input', () => {
                // Recalculate based on default percentages when income changes
                budgetCategories.forEach(c => c.percent = c.defaultPercent);
                calculateBudgetBreakdown();
                renderBudgetTable();
            });

            incomeFrequencySelect.addEventListener('change', (e) => {
                incomeFrequencySelect.dataset.current = e.target.value;
                // Recalculate based on default percentages when frequency changes
                budgetCategories.forEach(c => c.percent = c.defaultPercent);
                calculateBudgetBreakdown();
                renderBudgetTable();
            });

            // Event listeners for language switch
            esButton.addEventListener('click', () => setLanguage('es'));
            enButton.addEventListener('click', () => setLanguage('en'));
        }

        // Run initialization on page load
        window.onload = init;
    </script>
</body>
</html>
